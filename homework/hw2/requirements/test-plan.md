# Тест план

## Базовый тест-план

## 1.1 Создание устройства

### Тест 1 Регистрация устройства GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe

| Шаг | Действие                                                                                              | Ожидаемый результат                                                                                                                                                                                                                                 |
|-----|-------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос CreateDeviceV1Request со следующими параметрами:<br/> `user_id =1, platform = 'ios'` | * Пришел ответ CreateDeviceV1Response с deviceId > 0 (**device_ID_1**)"<br/> * В БД появилась 1 запись: platform='ios', user_id=1,entered_at >= Текущее время (**timestamp_1**), removed =false, created_at >= entered_at, updated_at >= created_at |
| 2   | Выполните запрос: DescribeDeviceV1Request c device_id = **device_ID_1**                               | Получен ответ DescribeDeviceV1Response с Device = {id = **device_ID_1**, platform='ios', user_id =1, etered_at = ± **timestamp_1** }                                                                                                                |

## 1.2 Получение информации об устройстве

### Тест 1 Получение информации об устройстве GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Устройство с device_id должно сущестовать в БД и не должно быть удалено (removed = false)

| Шаг | Действие                                                                         | Ожидаемый результат                                                                                                                                                                                                                                 |
|-----|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Выполните запрос: DescribeDeviceV1Request c device_id = **device_ID_1**          | * Получен ответ DescribeDeviceV1Response с device со следующими полями { id = **device_ID_1** типа uint64, platform типа string, user_id типа uint64, entered_at типа Timestamp } <br/> * В БД не изменилась запись о device c id = **device_ID_1** |

## 1.3 Редактирование устройства

### Тест 1 Редактирование устройства user_id + platform (32 символа) GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Устройство с device_id должно сущестовать в БД и не должно быть удалено (removed = false)

| Шаг | Действие                                                                                                                                                                     | Ожидаемый результат                                                                                                                                                                                                                                                |
|-----|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос UpdateDeviceV1Request c device_id = **device_ID_1** со следующими параметрами:<br/> `user_id = 13, platform = XiaomiAndroidProSuperMegaUltra2' (32 символа) | * Пришел ответ UpdateDeviceV1Request: 'success = true' "<br/> * В БД обновилась 1 запись: platform='XiaomiAndroidProSuperMegaUltra2', user_id=13,entered_at >= Текущее время (**timestamp_1**), removed =false, created_at >= entered_at, updated_at >= created_at |
| 2   | Выполните запрос: DescribeDeviceV1Request c device_id = **device_ID_1**                                                                                                      | Получен ответ DescribeDeviceV1Response с Device = {id = **device_ID_1**, platform='XiaomiAndroidProSuperMegaUltra2', user_id =13, etered_at = ± **timestamp_1** }                                                                                                  |

### Тест 2 Редактирование устройства platform (1 символ) GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Устройство с device_id должно сущестовать в БД и не должно быть удалено (removed = false)

| Шаг | Действие                                                                                                                                                  | Ожидаемый результат                                                                                                                                                                                                                  |
|-----|-----------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос UpdateDeviceV1Request c device_id = **device_ID_1** со следующими параметрами:<br/> `user_id = не изменяется, platform = X' (32 символа) | * Пришел ответ UpdateDeviceV1Request: 'success = true' "<br/> * В БД обновилась 1 запись: platform='X', user_id=13,entered_at >= Текущее время (**timestamp_1**), removed =false, created_at >= entered_at, updated_at >= created_at |
| 2   | Выполните запрос: DescribeDeviceV1Request c device_id = **device_ID_1**                                                                                   | Получен ответ DescribeDeviceV1Response с Device = {id = **device_ID_1**, platform='X', user_id =13, etered_at = ± **timestamp_1** }                                                                                                  |

### Тест 3 Редактирование устройства user_id (uint64_MaxValue) GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe 
3) Устройство с device_id должно сущестовать в БДи не должно быть удалено (removed = false)

| Шаг | Действие                                                                                                                                                        | Ожидаемый результат                                                                                                                                                                                                                                    |
|-----|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос UpdateDeviceV1Request c device_id = **device_ID_1** со следующими параметрами:<br/> `user_id = uint64_MaxValue, platform = не изменяется' | * Пришел ответ UpdateDeviceV1Request: 'success = true' "<br/> * В БД обновилась 1 запись: platform='X', user_id=uint64_MaxValue,entered_at >= Текущее время (**timestamp_1**), removed =false, created_at >= entered_at, updated_at >= created_at |
| 2   | Выполните запрос: DescribeDeviceV1Request c device_id = **device_ID_1**                                                                                         | Получен ответ DescribeDeviceV1Response с Device = {id = **device_ID_1**, platform='X', user_id =18446744073709551615, etered_at = ± **timestamp_1** }                                                                                                  |

### Тест 4 Редактирование устройства user_id (=1) GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Устройство с device_id должно сущестовать в БД и не должно быть удалено (removed = false)

| Шаг | Действие                                                                                                                         | Ожидаемый результат                                                                                                                                                                                                                 |
|-----|----------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос UpdateDeviceV1Request c device_id = **device_ID_1** со следующими параметрами:<br/> `user_id = 1, platform = X' | * Пришел ответ UpdateDeviceV1Request: 'success = true' "<br/> * В БД обновилась 1 запись: platform='X', user_id=1,entered_at >= Текущее время (**timestamp_1**), removed =false, created_at >= entered_at, updated_at >= created_at |
| 2   | Выполните запрос: DescribeDeviceV1Request c device_id = **device_ID_1**                                                          | Получен ответ DescribeDeviceV1Response с Device = {id = **device_ID_1**, platform='X', user_id =1, etered_at = ± **timestamp_1** }                                                                                                  |


## 1.4 Удаление устройства

### Тест 1 Удаление устройства GRPC

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Устройство с device_id должно существаовать в системе и не должно быть удалено (removed = false)

| Шаг | Действие                                                                | Ожидаемый результат                                                                                                                       |
|-----|-------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос RemoveDeviceV1Request c device_id = **device_ID_1**    | * Пришел ответ RemoveDeviceV1Response с found = true "<br/>   * В БД обновилась 1 запись c id = **device_ID_1** в поле removed = True     |

## 1.5 Список устройств

### Тест 1 Получение списка устройств, где количество устройств = per_page - 1

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Количество устройств = per_page - 1
4) Для устройств свойство removed = false

| Шаг | Действие                                                                                    | Ожидаемый результат                                                                           |
|-----|---------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос ListDevicesV1Request c параметрами:<br/>  'page = 1, per_page = items + 1' | * Пришел ответ ListDevicesV1Response с items, количество items должно быть равно per_page - 1 |

### Тест 2 Получение списка устройств, где количество устройств = per_page

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Количество устройств = per_page
4) Для устройств свойство removed = false

| Шаг | Действие                                                                                | Ожидаемый результат                                                                         |
|-----|-----------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос ListDevicesV1Request c параметрами:<br/>  'page = 1, per_page = items' | * Пришел ответ ListDevicesV1Response с items, количество items должно быть равно per_page   |

### Тест 3 Получение списка устройств, где количество устройств = per_page + 1

Предварительные условия:
1) Система запущена.
2) Проходит Readiness probe
3) Количество устройств = per_page + 1
4) Для устройств свойство removed = false

| Шаг | Действие                                                                                                       | Ожидаемый результат                                                                |
|-----|----------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
| 1.  | Отправьте запрос ListDevicesV1Request c параметрами:<br/>  'page = ceil(items/per_page), per_page = items - 1' | * Пришел ответ ListDevicesV1Response с items, количество items должно быть равно 1 |